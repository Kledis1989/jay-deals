<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JAI Deals - Affari Mezzi Pesanti</title>
    <meta name="description" content="Dashboard intelligente per trovare i migliori affari su mezzi pesanti usati in Europa">
    <style>
        :root {
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-bg-tertiary: #334155;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-accent: #38bdf8;
            --color-accent-hover: #0ea5e9;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-border: #475569;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header */
        .header {
            background: var(--color-bg-secondary);
            padding: 1rem 0;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent);
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            color: var(--color-text-secondary);
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
        }

        .nav-tab.active {
            background: var(--color-accent);
            color: var(--color-bg-primary);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-bg-secondary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--color-border);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .stat-trend {
            font-size: 0.875rem;
            color: var(--color-success);
            margin-top: 0.25rem;
        }

        /* Filters */
        .filters {
            background: var(--color-bg-secondary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--color-border);
            margin-bottom: 2rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .filter-input, .filter-select {
            padding: 0.625rem;
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            color: var(--color-text-primary);
            font-size: 0.875rem;
        }

        .filter-input:focus, .filter-select:focus {
            outline: 2px solid var(--color-accent);
            border-color: var(--color-accent);
        }

        .filters-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-accent);
            color: var(--color-bg-primary);
        }

        .btn-primary:hover {
            background: var(--color-accent-hover);
        }

        .btn-secondary {
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        /* Listings Grid */
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .listing-card {
            background: var(--color-bg-secondary);
            border-radius: 0.75rem;
            border: 1px solid var(--color-border);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .listing-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-color: var(--color-accent);
        }

        .listing-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: var(--color-bg-tertiary);
        }

        .listing-content {
            padding: 0.875rem;
        }

        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .listing-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 0.25rem;
        }

        .score-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 700;
            min-width: 42px;
            text-align: center;
        }

        .score-excellent {
            background: var(--color-success);
            color: white;
        }

        .score-good {
            background: var(--color-accent);
            color: var(--color-bg-primary);
        }

        .score-fair {
            background: var(--color-warning);
            color: var(--color-bg-primary);
        }

        .listing-details {
            display: flex;
            flex-wrap: wrap;
            gap: 0.625rem;
            margin-bottom: 0.75rem;
            font-size: 0.8125rem;
            color: var(--color-text-secondary);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .listing-price {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.75rem;
        }

        .price-main {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--color-accent);
        }

        .price-market {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        .listing-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .badge {
            padding: 0.1875rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.6875rem;
            font-weight: 500;
        }

        .badge-vendor {
            background: var(--color-success);
            color: white;
        }

        .badge-new {
            background: var(--color-accent);
            color: var(--color-bg-primary);
        }

        .badge-risk {
            background: var(--color-danger);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--color-bg-secondary);
            border-radius: 1rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        .modal-close:hover {
            color: var(--color-text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .detail-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--color-accent);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .detail-field {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .field-label {
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        .field-value {
            font-size: 1rem;
            color: var(--color-text-primary);
            font-weight: 500;
        }

        .score-breakdown {
            background: var(--color-bg-tertiary);
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--color-border);
        }

        .score-item:last-child {
            border-bottom: none;
        }

        .score-bar {
            width: 200px;
            height: 8px;
            background: var(--color-bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }

        .score-bar-fill {
            height: 100%;
            background: var(--color-accent);
            transition: width 0.3s;
        }

        .workflow-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .workflow-btn {
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--color-border);
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
            transition: all 0.2s;
        }

        .workflow-btn:hover {
            background: var(--color-accent);
            color: var(--color-bg-primary);
            border-color: var(--color-accent);
        }

        .workflow-btn.active {
            background: var(--color-accent);
            color: var(--color-bg-primary);
            border-color: var(--color-accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-wrap: wrap;
            }

            .listings-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .modal {
                padding: 1rem;
            }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--color-text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">JAI Deals üöú</div>
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-view="top-deals">Top Affari</button>
                    <button class="nav-tab" data-view="new-today">Nuovi Oggi</button>
                    <button class="nav-tab" data-view="still-available">Ancora Disponibili</button>
                    <button class="nav-tab" data-view="saved">Salvati</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-label">Affari Totali</div>
                    <div class="stat-value" id="total-deals">127</div>
                    <div class="stat-trend">+15 questa settimana</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Top Score Medio</div>
                    <div class="stat-value">87</div>
                    <div class="stat-trend">Eccellente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Nuovi Oggi</div>
                    <div class="stat-value" id="new-today-count">12</div>
                    <div class="stat-trend">Da verificare</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">In Trattativa</div>
                    <div class="stat-value" id="in-negotiation">8</div>
                    <div class="stat-trend">Aggiornati</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <h2 style="margin-bottom: 0.5rem;">Filtri Avanzati</h2>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Categoria</label>
                        <select class="filter-select" id="filter-category">
                            <option value="">Tutte</option>
                            <option value="excavator">Escavatori</option>
                            <option value="loader">Pale</option>
                            <option value="backhoe">Terne</option>
                            <option value="dumper">Dumper</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Marca</label>
                        <select class="filter-select" id="filter-brand">
                            <option value="">Tutte</option>
                            <option value="Caterpillar">Caterpillar</option>
                            <option value="Komatsu">Komatsu</option>
                            <option value="Volvo">Volvo</option>
                            <option value="JCB">JCB</option>
                            <option value="Hitachi">Hitachi</option>
                            <option value="Case">Case</option>
                            <option value="Doosan">Doosan</option>
                            <option value="New Holland">New Holland</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Paese</label>
                        <select class="filter-select" id="filter-country">
                            <option value="">Tutti</option>
                            <option value="IT">Italia</option>
                            <option value="DE">Germania</option>
                            <option value="FR">Francia</option>
                            <option value="PL">Polonia</option>
                            <option value="ES">Spagna</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Prezzo Min (‚Ç¨)</label>
                        <input type="number" class="filter-input" id="filter-price-min" placeholder="es. 20000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Prezzo Max (‚Ç¨)</label>
                        <input type="number" class="filter-input" id="filter-price" placeholder="es. 50000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ore Min</label>
                        <input type="number" class="filter-input" id="filter-hours-min" placeholder="es. 1000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ore Max</label>
                        <input type="number" class="filter-input" id="filter-hours" placeholder="es. 5000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Anno Min</label>
                        <input type="number" class="filter-input" id="filter-year" placeholder="es. 2015">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Anno Max</label>
                        <input type="number" class="filter-input" id="filter-year-max" placeholder="es. 2024">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Score Min</label>
                        <input type="number" class="filter-input" id="filter-score-min" placeholder="es. 80" min="0" max="100">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Margine Min (‚Ç¨)</label>
                        <input type="number" class="filter-input" id="filter-margin-min" placeholder="es. 10000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Venditore</label>
                        <select class="filter-select" id="filter-vendor">
                            <option value="">Tutti</option>
                            <option value="private">Solo Privati</option>
                            <option value="micro">Micro-Imprese</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Sorgente</label>
                        <select class="filter-select" id="filter-source">
                            <option value="">Tutte</option>
                            <option value="Mascus">Mascus</option>
                            <option value="TruckScout24">TruckScout24</option>
                            <option value="subito.it">subito.it</option>
                            <option value="Leboncoin">Leboncoin</option>
                            <option value="Wallapop">Wallapop</option>
                            <option value="Kleinanzeigen">Kleinanzeigen</option>
                            <option value="OLX">OLX</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Condizioni</label>
                        <select class="filter-select" id="filter-condition">
                            <option value="">Tutte</option>
                            <option value="Eccellente">Eccellente</option>
                            <option value="Ottima">Ottima</option>
                            <option value="Buona">Buona</option>
                            <option value="Discreta">Discreta</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Sconto Min (%)</label>
                        <input type="number" class="filter-input" id="filter-discount-min" placeholder="es. 20" min="0" max="100">
                    </div>
                </div>
                <div class="filters-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">Applica Filtri</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
                    <button class="btn btn-secondary" onclick="exportData()">Esporta PDF</button>
                </div>
            </div>

            <!-- Views -->
            <div id="top-deals" class="view active">
                <h2 style="margin-bottom: 1.5rem;">üèÜ Top 10 Affari</h2>
                <div class="listings-grid" id="top-deals-grid"></div>
            </div>

            <div id="new-today" class="view">
                <h2 style="margin-bottom: 1.5rem;">üÜï Nuovi Oggi</h2>
                <div class="listings-grid" id="new-today-grid"></div>
            </div>

            <div id="still-available" class="view">
                <h2 style="margin-bottom: 1.5rem;">‚úÖ Ancora Disponibili</h2>
                <div class="listings-grid" id="still-available-grid"></div>
            </div>

            <div id="saved" class="view">
                <h2 style="margin-bottom: 1.5rem;">üíæ Salvati</h2>
                <div class="listings-grid" id="saved-grid"></div>
            </div>
        </div>
    </main>

    <!-- Detail Modal -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script>
        // Mock Data
        const mockListings = [
            {
                id: 1,
                title: 'CAT 320D Escavatore',
                brand: 'Caterpillar',
                model: '320D',
                category: 'excavator',
                year: 2018,
                hours: 3200,
                price: 45000,
                priceMarket: 62000,
                priceAllInclusive: 48500,
                resaleEstimate: 68000,
                margin: 19500,
                country: 'DE',
                city: 'Monaco',
                vendor: 'private',
                score: 92,
                isNew: true,
                accessories: ['Martello idraulico', '3 benne', 'Quick coupler'],
                condition: 'Ottima',
                documents: ['CE', 'Libretto'],
                source: 'Mascus',
                sourceUrl: 'https://www.mascus.com/construction/used-excavators/caterpillar-320d/listing-123',
                image: 'https://images.unsplash.com/photo-1581094271901-8022df4466f9?w=400&h=300&fit=crop',
                workflow: null,
                saved: false
            },
            {
                id: 2,
                title: 'JCB 3CX Terna',
                brand: 'JCB',
                model: '3CX',
                category: 'backhoe',
                year: 2019,
                hours: 2800,
                price: 38000,
                priceMarket: 48000,
                priceAllInclusive: 40200,
                resaleEstimate: 52000,
                margin: 11800,
                country: 'PL',
                city: 'Varsavia',
                vendor: 'micro',
                score: 88,
                isNew: true,
                accessories: ['Benna standard', 'Stabilizzatori'],
                condition: 'Buona',
                documents: ['CE'],
                source: 'TruckScout24',
                sourceUrl: 'https://www.truckscout24.com/backhoe-loader/jcb-3cx/listing-456',
                image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=400&h=300&fit=crop',
                workflow: null,
                saved: false
            },
            {
                id: 3,
                title: 'Komatsu PC210-8 Escavatore',
                brand: 'Komatsu',
                model: 'PC210-8',
                category: 'excavator',
                year: 2017,
                hours: 4500,
                price: 52000,
                priceMarket: 68000,
                priceAllInclusive: 55800,
                resaleEstimate: 72000,
                margin: 16200,
                country: 'IT',
                city: 'Milano',
                vendor: 'private',
                score: 86,
                isNew: false,
                accessories: ['2 benne', 'Rototilt'],
                condition: 'Buona',
                documents: ['CE', 'Libretto', 'Fatture'],
                source: 'subito.it',
                sourceUrl: 'https://www.subito.it/mezzi-pesanti/komatsu-pc210-8-milano-789',
                image: 'https://images.unsplash.com/photo-1625664974988-6c5e68f96555?w=400&h=300&fit=crop',
                workflow: 'contacted',
                saved: true
            },
            {
                id: 4,
                title: 'Volvo L90H Pala Gommata',
                brand: 'Volvo',
                model: 'L90H',
                category: 'loader',
                year: 2020,
                hours: 1800,
                price: 68000,
                priceMarket: 82000,
                priceAllInclusive: 70500,
                resaleEstimate: 88000,
                margin: 17500,
                country: 'FR',
                city: 'Parigi',
                vendor: 'private',
                score: 91,
                isNew: true,
                accessories: ['Benna 3m¬≥', 'GPS', 'Aria condizionata'],
                condition: 'Eccellente',
                documents: ['CE', 'Libretto', 'Verifiche periodiche'],
                source: 'Leboncoin',
                sourceUrl: 'https://www.leboncoin.fr/materiel-professionnel/volvo-l90h-paris-234',
                image: 'https://images.unsplash.com/photo-1621884357856-1a99b9e7faa8?w=400&h=300&fit=crop',
                workflow: null,
                saved: false
            },
            {
                id: 5,
                title: 'Hitachi ZX135US-5 Mini Escavatore',
                brand: 'Hitachi',
                model: 'ZX135US-5',
                category: 'excavator',
                year: 2019,
                hours: 2200,
                price: 42000,
                priceMarket: 54000,
                priceAllInclusive: 44800,
                resaleEstimate: 58000,
                margin: 13200,
                country: 'ES',
                city: 'Barcellona',
                vendor: 'private',
                score: 89,
                isNew: true,
                accessories: ['Zero tail', '2 benne', 'Martello'],
                condition: 'Ottima',
                documents: ['CE', 'Libretto'],
                source: 'Wallapop',
                sourceUrl: 'https://es.wallapop.com/item/hitachi-zx135us-5-barcelona-567',
                image: 'https://images.unsplash.com/photo-1581092162384-8987c1d64718?w=400&h=300&fit=crop',
                workflow: 'to_call',
                saved: true
            },
            {
                id: 6,
                title: 'Case 580ST Terna',
                brand: 'Case',
                model: '580ST',
                category: 'backhoe',
                year: 2016,
                hours: 5200,
                price: 32000,
                priceMarket: 42000,
                priceAllInclusive: 34500,
                resaleEstimate: 45000,
                margin: 10500,
                country: 'DE',
                city: 'Berlino',
                vendor: 'micro',
                score: 82,
                isNew: false,
                accessories: ['Benna', 'Forcale'],
                condition: 'Discreta',
                documents: ['CE'],
                source: 'Kleinanzeigen',
                sourceUrl: 'https://www.kleinanzeigen.de/case-580st-berlin-890',
                image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=400&h=300&fit=crop',
                workflow: null,
                saved: false
            },
            {
                id: 7,
                title: 'Doosan DX140LC Escavatore',
                brand: 'Doosan',
                model: 'DX140LC',
                category: 'excavator',
                year: 2018,
                hours: 3800,
                price: 48000,
                priceMarket: 61000,
                priceAllInclusive: 51200,
                resaleEstimate: 65000,
                margin: 13800,
                country: 'PL',
                city: 'Cracovia',
                vendor: 'private',
                score: 85,
                isNew: false,
                accessories: ['Long reach', '2 benne'],
                condition: 'Buona',
                documents: ['CE', 'Libretto'],
                source: 'OLX',
                sourceUrl: 'https://www.olx.pl/doosan-dx140lc-krakow-345',
                image: 'https://images.unsplash.com/photo-1581094271901-8022df4466f9?w=400&h=300&fit=crop',
                workflow: 'in_negotiation',
                saved: true
            },
            {
                id: 8,
                title: 'New Holland B115 Terna',
                brand: 'New Holland',
                model: 'B115',
                category: 'backhoe',
                year: 2020,
                hours: 1500,
                price: 44000,
                priceMarket: 55000,
                priceAllInclusive: 46200,
                resaleEstimate: 58000,
                margin: 11800,
                country: 'IT',
                city: 'Roma',
                vendor: 'private',
                score: 87,
                isNew: true,
                accessories: ['Benna', 'Martello', 'Estensione'],
                condition: 'Ottima',
                documents: ['CE', 'Libretto', 'Fatture'],
                source: 'subito.it',
                sourceUrl: 'https://www.subito.it/mezzi-pesanti/new-holland-b115-roma-678',
                image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=400&h=300&fit=crop',
                workflow: null,
                saved: false
            }
        ];

        let currentListings = [...mockListings];
        let selectedListing = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            renderListings('top-deals');
        });

        // Navigation
        function setupNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const views = document.querySelectorAll('.view');
                    views.forEach(v => v.classList.remove('active'));
                    
                    const viewId = tab.dataset.view;
                    document.getElementById(viewId).classList.add('active');
                    
                    renderListings(viewId);
                });
            });
        }

        // Render Listings
        function renderListings(viewType) {
            // Ensure we're working with the original data
            if (currentListings.length === 0) {
                currentListings = [...mockListings];
            }
            
            let filteredListings = [...currentListings];
            
            switch(viewType) {
                case 'top-deals':
                    filteredListings = filteredListings
                        .sort((a, b) => b.score - a.score)
                        .slice(0, 10);
                    break;
                case 'new-today':
                    filteredListings = filteredListings.filter(l => l.isNew);
                    break;
                case 'still-available':
                    filteredListings = filteredListings.filter(l => !l.workflow || l.workflow === 'to_call');
                    break;
                case 'saved':
                    filteredListings = filteredListings.filter(l => l.saved);
                    break;
            }
            
            const gridId = viewType + '-grid';
            const grid = document.getElementById(gridId);
            
            if (filteredListings.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>Nessun annuncio trovato</h3>
                        <p>Prova a modificare i filtri o controlla pi√π tardi</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filteredListings.map(listing => createListingCard(listing)).join('');
        }

        // Create Listing Card
        function createListingCard(listing) {
            const scoreClass = listing.score >= 85 ? 'score-excellent' : listing.score >= 75 ? 'score-good' : 'score-fair';
            const discount = Math.round(((listing.priceMarket - listing.price) / listing.priceMarket) * 100);
            
            return `
                <div class="listing-card" onclick="openModal(${listing.id})">
                    <img src="${listing.image}" alt="${listing.title}" class="listing-image">
                    <div class="listing-content">
                        <div class="listing-header">
                            <div>
                                <div class="listing-title">${listing.title}</div>
                                <div style="font-size: 0.875rem; color: var(--color-text-muted);">
                                    ${listing.city}, ${listing.country}
                                </div>
                            </div>
                            <div class="score-badge ${scoreClass}">${listing.score}</div>
                        </div>
                        
                        <div class="listing-details">
                            <div class="detail-item">üìÖ ${listing.year}</div>
                            <div class="detail-item">‚è±Ô∏è ${listing.hours.toLocaleString()}h</div>
                            <div class="detail-item">üîß ${listing.accessories.length} acc.</div>
                        </div>
                        
                        <div class="listing-price">
                            <div>
                                <div class="price-main">‚Ç¨${listing.price.toLocaleString()}</div>
                                <div class="price-market">Mercato: ‚Ç¨${listing.priceMarket.toLocaleString()} (-${discount}%)</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.875rem; color: var(--color-success); font-weight: 600;">
                                    Margine: ‚Ç¨${listing.margin.toLocaleString()}
                                </div>
                            </div>
                        </div>
                        
                        <div class="listing-badges">
                            ${listing.vendor === 'private' ? '<span class="badge badge-vendor">Privato</span>' : ''}
                            ${listing.isNew ? '<span class="badge badge-new">Nuovo</span>' : ''}
                            ${listing.saved ? '<span class="badge" style="background: var(--color-accent); color: white;">üíæ Salvato</span>' : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Modal Functions
        function openModal(id) {
            const listing = currentListings.find(l => l.id === id);
            if (!listing) return;
            
            selectedListing = listing;
            
            const scoreBreakdown = [
                { label: 'Convenienza vs Mercato', value: 35, percentage: 100 },
                { label: 'Margine Stimato', value: 25, percentage: 90 },
                { label: 'Qualit√†/Condizioni', value: 15, percentage: 100 },
                { label: 'Ore e Anno', value: 10, percentage: 85 },
                { label: 'Venditore Privato', value: 10, percentage: 100 },
                { label: 'Penalit√† Rischio', value: -3, percentage: 0 }
            ];
            
            const workflowStates = [
                { id: null, label: 'Nessuna azione' },
                { id: 'saved', label: 'üíæ Salva' },
                { id: 'to_call', label: 'üìû Da chiamare' },
                { id: 'contacted', label: '‚úâÔ∏è Contattato' },
                { id: 'in_negotiation', label: 'üí¨ In trattativa' },
                { id: 'rejected', label: '‚ùå Scartato' }
            ];
            
            document.getElementById('modal-title').textContent = listing.title;
            document.getElementById('modal-body').innerHTML = `
                <div class="detail-section">
                    <img src="${listing.image}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    
                    <div class="section-title">Punteggio Affare: ${listing.score}/100</div>
                    <div class="score-breakdown">
                        ${scoreBreakdown.map(item => `
                            <div class="score-item">
                                <div>
                                    <div style="font-weight: 500;">${item.label}</div>
                                    <div style="font-size: 0.875rem; color: var(--color-text-muted);">Peso: ${item.value}</div>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" style="width: ${item.percentage}%;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="section-title">Dettagli Tecnici</div>
                    <div class="detail-grid">
                        <div class="detail-field">
                            <div class="field-label">Marca</div>
                            <div class="field-value">${listing.brand}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Modello</div>
                            <div class="field-value">${listing.model}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Anno</div>
                            <div class="field-value">${listing.year}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Ore</div>
                            <div class="field-value">${listing.hours.toLocaleString()}h</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Condizioni</div>
                            <div class="field-value">${listing.condition}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Documenti</div>
                            <div class="field-value">${listing.documents.join(', ')}</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="section-title">Analisi Economica</div>
                    <div class="detail-grid">
                        <div class="detail-field">
                            <div class="field-label">Prezzo Annuncio</div>
                            <div class="field-value" style="color: var(--color-accent);">‚Ç¨${listing.price.toLocaleString()}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Prezzo All-Inclusive</div>
                            <div class="field-value">‚Ç¨${listing.priceAllInclusive.toLocaleString()}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Prezzo Mercato</div>
                            <div class="field-value">‚Ç¨${listing.priceMarket.toLocaleString()}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Scostamento</div>
                            <div class="field-value" style="color: var(--color-success);">-${Math.round(((listing.priceMarket - listing.price) / listing.priceMarket) * 100)}%</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Rivendita Stimata</div>
                            <div class="field-value">‚Ç¨${listing.resaleEstimate.toLocaleString()}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Margine Stimato</div>
                            <div class="field-value" style="color: var(--color-success); font-size: 1.25rem;">‚Ç¨${listing.margin.toLocaleString()}</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="section-title">Accessori e Dotazioni</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${listing.accessories.map(acc => `
                            <span class="badge" style="background: var(--color-bg-tertiary); color: var(--color-text-primary);">${acc}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="section-title">Informazioni Venditore</div>
                    <div class="detail-grid">
                        <div class="detail-field">
                            <div class="field-label">Tipo</div>
                            <div class="field-value">${listing.vendor === 'private' ? 'üë§ Privato' : 'üè¢ Micro-Impresa'}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Localit√†</div>
                            <div class="field-value">${listing.city}, ${listing.country}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Sorgente</div>
                            <div class="field-value">
                                <a href="${listing.sourceUrl}" target="_blank" rel="noopener noreferrer" 
                                   style="color: var(--color-accent); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;"
                                   onclick="event.stopPropagation();">
                                    ${listing.source}
                                    <span style="font-size: 0.875rem;">üîó</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="section-title">Workflow Operativo</div>
                    <div class="workflow-actions">
                        ${workflowStates.map(state => `                    <button class="workflow-btn ${listing.workflow === state.id ? 'active' : ''}" 
                            onclick="event.stopPropagation(); updateWorkflow(${listing.id}, '${state.id}')">
                        ${state.label}
                    </button>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('detail-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
        }

        function updateWorkflow(id, state) {
            const listing = currentListings.find(l => l.id === id);
            if (!listing) return;
            
            listing.workflow = state === 'null' ? null : state;
            
            if (state === 'saved') {
                listing.saved = true;
            }
            
            // Update the original mockListings array to persist changes
            const originalListing = mockListings.find(l => l.id === id);
            if (originalListing) {
                originalListing.workflow = listing.workflow;
                originalListing.saved = listing.saved;
            }
            
            openModal(id);
            renderListings(document.querySelector('.nav-tab.active').dataset.view);
        }

        // Filters
        function applyFilters() {
            const category = document.getElementById('filter-category').value;
            const brand = document.getElementById('filter-brand').value;
            const country = document.getElementById('filter-country').value;
            const minPrice = document.getElementById('filter-price-min').value;
            const maxPrice = document.getElementById('filter-price').value;
            const minHours = document.getElementById('filter-hours-min').value;
            const maxHours = document.getElementById('filter-hours').value;
            const minYear = document.getElementById('filter-year').value;
            const maxYear = document.getElementById('filter-year-max').value;
            const minScore = document.getElementById('filter-score-min').value;
            const minMargin = document.getElementById('filter-margin-min').value;
            const vendor = document.getElementById('filter-vendor').value;
            const source = document.getElementById('filter-source').value;
            const condition = document.getElementById('filter-condition').value;
            const minDiscount = document.getElementById('filter-discount-min').value;
            
            currentListings = mockListings.filter(listing => {
                if (category && listing.category !== category) return false;
                if (brand && listing.brand !== brand) return false;
                if (country && listing.country !== country) return false;
                if (minPrice && listing.price < parseInt(minPrice)) return false;
                if (maxPrice && listing.price > parseInt(maxPrice)) return false;
                if (minHours && listing.hours < parseInt(minHours)) return false;
                if (maxHours && listing.hours > parseInt(maxHours)) return false;
                if (minYear && listing.year < parseInt(minYear)) return false;
                if (maxYear && listing.year > parseInt(maxYear)) return false;
                if (minScore && listing.score < parseInt(minScore)) return false;
                if (minMargin && listing.margin < parseInt(minMargin)) return false;
                if (vendor && listing.vendor !== vendor) return false;
                if (source && listing.source !== source) return false;
                if (condition && listing.condition !== condition) return false;
                if (minDiscount) {
                    const discount = Math.round(((listing.priceMarket - listing.price) / listing.priceMarket) * 100);
                    if (discount < parseInt(minDiscount)) return false;
                }
                return true;
            });
            
            renderListings(document.querySelector('.nav-tab.active').dataset.view);
            
            document.getElementById('total-deals').textContent = currentListings.length;
        }

        function resetFilters() {
            document.getElementById('filter-category').value = '';
            document.getElementById('filter-brand').value = '';
            document.getElementById('filter-country').value = '';
            document.getElementById('filter-price-min').value = '';
            document.getElementById('filter-price').value = '';
            document.getElementById('filter-hours-min').value = '';
            document.getElementById('filter-hours').value = '';
            document.getElementById('filter-year').value = '';
            document.getElementById('filter-year-max').value = '';
            document.getElementById('filter-score-min').value = '';
            document.getElementById('filter-margin-min').value = '';
            document.getElementById('filter-vendor').value = '';
            document.getElementById('filter-source').value = '';
            document.getElementById('filter-condition').value = '';
            document.getElementById('filter-discount-min').value = '';
            
            currentListings = [...mockListings];
            renderListings(document.querySelector('.nav-tab.active').dataset.view);
            
            document.getElementById('total-deals').textContent = currentListings.length;
        }

        function exportData() {
            alert('Funzionalit√† export PDF: in un\'app reale, questo genererebbe un PDF con tutti gli annunci filtrati.\n\nIncluderebbe:\n- Lista completa con foto\n- Dettagli tecnici ed economici\n- Punteggi e analisi\n- Note operative');
        }

        // Close modal on outside click
        document.getElementById('detail-modal').addEventListener('click', (e) => {
            if (e.target.id === 'detail-modal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
